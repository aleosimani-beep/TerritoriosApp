<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>TerritoriosApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #111827;
      background: #e5e7eb;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      background: radial-gradient(circle at top, #eef2ff 0, #e5e7eb 40%, #d1d5db 100%);
    }
    .app {
      background: #f9fafb;
      margin: 0.75rem;
      margin-bottom: 3.5rem;
      border-radius: 1rem;
      max-width: 960px;
      width: 100%;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    header {
      padding: 0.9rem 1.1rem;
      background: linear-gradient(135deg,#2563eb,#4f46e5);
      color: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    header h1 {
      margin: 0;
      font-size: 1.25rem;
    }
    header .subtitle {
      font-size: 0.8rem;
      opacity: 0.9;
    }
    .badge {
      background: rgba(15,23,42,0.25);
      border-radius: 999px;
      padding: 0.15rem 0.7rem;
      font-size: 0.75rem;
    }

    main {
      padding: 1rem 1.1rem 0.5rem 1.1rem;
      flex: 1;
      overflow-y: auto;
      box-sizing: border-box;
    }

    h2 {
      font-size: 1.1rem;
      margin: 0 0 0.6rem 0;
      color: #111827;
    }
    h3 {
      font-size: 0.95rem;
      margin: 0.7rem 0 0.4rem 0;
      color: #111827;
    }
    p {
      margin: 0.3rem 0;
    }
    .small-text {
      font-size: 0.78rem;
      color: #6b7280;
    }

    .card {
      background: #ffffff;
      border-radius: 0.9rem;
      padding: 0.8rem 0.9rem;
      margin-bottom: 0.9rem;
      border: 1px solid #e5e7eb;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.4rem;
    }
    .chip {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      border-radius: 999px;
      background: #e5e7eb;
      font-size: 0.75rem;
      color: #374151;
    }

    label {
      font-size: 0.78rem;
      display: block;
      margin-bottom: 0.15rem;
      color: #374151;
    }
    input[type="text"],
    input[type="date"],
    input[type="time"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      box-sizing: border-box;
      font-size: 0.85rem;
      padding: 0.45rem 0.5rem;
      border-radius: 0.5rem;
      border: 1px solid #d1d5db;
      background: #ffffff;
      margin-bottom: 0.45rem;
    }
    input:focus,
    textarea:focus,
    select:focus {
      outline: 2px solid #2563eb33;
      border-color: #2563eb;
    }
    textarea {
      min-height: 60px;
      resize: vertical;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 0.45rem 0.9rem;
      font-size: 0.85rem;
      cursor: pointer;
      background: #2563eb;
      color: #f9fafb;
      font-weight: 600;
    }
    button:active {
      transform: scale(0.97);
    }
    .btn-secondary {
      background: #6b7280;
      color: #f9fafb;
    }
    .btn-danger {
      background: #dc2626;
    }
    .btn-small {
      font-size: 0.75rem;
      padding: 0.25rem 0.55rem;
    }
    .btn-outline {
      background: transparent;
      border: 1px solid #d1d5db;
      color: #111827;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.78rem;
      margin-top: 0.3rem;
    }
    th, td {
      border: 1px solid #e5e7eb;
      padding: 0.25rem 0.3rem;
      text-align: left;
    }
    th {
      background: #f3f4f6;
      font-weight: 600;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.1rem 0.5rem;
      border-radius: 999px;
      font-size: 0.7rem;
    }
    .pill-estado {
      background: #eef2ff;
      color: #4338ca;
    }

    .status-ok {
      color: #16a34a;
      font-size: 0.78rem;
      margin-top: 0.25rem;
    }
    .status-error {
      color: #b91c1c;
      font-size: 0.78rem;
      margin-top: 0.25rem;
    }

    /* Layouts espec√≠ficos */

    .salidas-grid {
      display: grid;
      grid-template-columns: 1.2fr 1fr 1fr;
      gap: 0.2rem;
      align-items: center;
    }
    .salidas-grid-header div {
      font-size: 0.78rem;
      font-weight: 600;
      color: #374151;
    }

    .territorio-color-preview {
      width: 1.2rem;
      height: 1.2rem;
      border-radius: 0.4rem;
      border: 1px solid #d1d5db;
      margin-left: 0.35rem;
    }
    .fila-territorio {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .flex-row {
      display: flex;
      gap: 0.5rem;
    }
    .flex-1 {
      flex: 1;
    }

    .interesado-card {
      border-radius: 0.7rem;
      border: 1px solid #e5e7eb;
      padding: 0.5rem 0.7rem;
      margin-top: 0.3rem;
      background: #ffffff;
    }
    .interesado-nombre {
      font-size: 0.85rem;
      font-weight: 600;
      margin-bottom: 0.1rem;
    }
    .interesado-detalle {
      font-size: 0.75rem;
      color: #4b5563;
    }

    .resumen-linea {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }

    /* NAV inferior */
    .bottom-nav {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      background: #111827;
      color: #e5e7eb;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 0.25rem 0;
      font-size: 0.75rem;
      z-index: 20;
    }
    .bottom-nav button {
      background: transparent;
      border-radius: 0;
      border: none;
      color: #9ca3af;
      font-weight: 400;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.05rem;
      padding: 0.2rem 0.5rem;
    }
    .bottom-nav button span.icon {
      font-size: 1.1rem;
      line-height: 1;
    }
    .bottom-nav button.active {
      color: #f9fafb;
      border-top: 2px solid #22c55e;
    }

    .section {
      display: none;
    }
    .section.active {
      display: block;
    }

    @media (min-width: 900px) {
      .bottom-nav {
        max-width: 960px;
        margin: 0 auto;
        border-radius: 999px 999px 0 0;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>TerritoriosApp</h1>
        <div class="subtitle">Salidas, territorios, interesados e informe personal</div>
      </div>
      <div class="badge">v1 ¬∑ localStorage</div>
    </header>

    <main>
      <!-- INICIO -->
      <section id="sec-inicio" class="section active">
        <div class="card">
          <div class="card-header">
            <h2>Salidas de hoy</h2>
            <span class="chip" id="chip-fecha-hoy"></span>
          </div>
          <div id="bloque-salidas-hoy">
            <p class="small-text">Cargando programa semanal...</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2>Atajos r√°pidos</h2>
          </div>
          <div class="flex-row">
            <button class="flex-1" onclick="cambiarSeccion('salidas')">üìÖ Editar salidas</button>
            <button class="flex-1 btn-secondary" onclick="cambiarSeccion('informe')">‚è±Ô∏è Registrar horas</button>
          </div>
          <p class="small-text" style="margin-top:0.5rem;">
            Todo se guarda autom√°ticamente en este dispositivo. Si borr√°s el historial o los datos del navegador, se pierden.
          </p>
        </div>
      </section>

      <!-- SALIDAS -->
      <section id="sec-salidas" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Programa semanal de salidas</h2>
            <span class="chip">Ma√±ana / Tarde</span>
          </div>
          <p class="small-text">
            Defin√≠ para cada d√≠a las salidas de ma√±ana y tarde (por ej. ‚ÄúTerritorios 1-2‚Äù, ‚ÄúPredicaci√≥n p√∫blica‚Äù, etc.).
          </p>

          <div class="salidas-grid salidas-grid-header" style="margin-top:0.4rem;">
            <div>D√≠a</div>
            <div>Ma√±ana</div>
            <div>Tarde</div>
          </div>
          <div id="contenedor-salidas-semana"></div>

          <button style="margin-top:0.6rem;" onclick="guardarSalidasSemana()">
            Guardar programa semanal
          </button>
          <div id="status-salidas" class="status-ok" style="display:none;"></div>
        </div>
      </section>

      <!-- TERRITORIOS -->
      <section id="sec-territorios" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Territorios</h2>
            <span class="chip" id="chip-total-territorios">0 registrados</span>
          </div>
          <p class="small-text">
            Pod√©s usar el color como referencia visual: por ejemplo, verde = trabajado recientemente, amarillo = por hacer, rojo = pendiente.
          </p>

          <h3>Nuevo territorio</h3>
          <div class="flex-row">
            <div class="flex-1">
              <label for="territorio-nombre">Nombre / n√∫mero</label>
              <input id="territorio-nombre" type="text" placeholder="Territorio 12 - Centro" />
            </div>
            <div style="width:110px;">
              <label for="territorio-color">Color</label>
              <div class="fila-territorio">
                <input id="territorio-color" type="color" value="#22c55e" />
                <div class="territorio-color-preview" id="territorio-color-preview"></div>
              </div>
            </div>
          </div>
          <label for="territorio-notas">Notas</label>
          <textarea id="territorio-notas" placeholder="Referencias, zonas especiales, etc."></textarea>

          <button onclick="agregarTerritorio()">Agregar territorio</button>
          <div id="status-territorio" class="status-ok" style="display:none;"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Lista de territorios</h3>
          </div>
          <table>
            <thead>
              <tr>
                <th>Territorio</th>
                <th>Notas</th>
                <th>Color</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tabla-territorios"></tbody>
          </table>
          <p id="msg-sin-territorios" class="small-text" style="margin-top:0.5rem; display:none;">
            Todav√≠a no cargaste territorios.
          </p>
        </div>
      </section>

      <!-- INTERESADOS -->
      <section id="sec-interesados" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Interesados</h2>
            <span class="chip" id="chip-total-interesados">0 contactos</span>
          </div>

          <h3>Nuevo interesado</h3>
          <label for="int-nombre">Nombre</label>
          <input id="int-nombre" type="text" placeholder="Nombre y apellido" />

          <label for="int-direccion">Direcci√≥n / referencia</label>
          <input id="int-direccion" type="text" placeholder="Calle, n√∫mero, barrio..." />

          <div class="flex-row">
            <div class="flex-1">
              <label for="int-telefono">Tel√©fono</label>
              <input id="int-telefono" type="text" placeholder="Ej: 351-1234567" />
            </div>
            <div class="flex-1">
              <label for="int-territorio">Territorio</label>
              <input id="int-territorio" type="text" placeholder="Ej: T-12" />
            </div>
          </div>

          <label for="int-notas">Notas</label>
          <textarea id="int-notas" placeholder="Cu√°ndo se visit√≥, publicaciones, comentarios, etc."></textarea>

          <button onclick="agregarInteresado()">Agregar interesado</button>
          <div id="status-interesado" class="status-ok" style="display:none;"></div>
        </div>

        <div class="card">
          <div class="card-header">
            <h3>Listado y b√∫squeda</h3>
          </div>
          <label for="buscador-interesados">Buscar por nombre, direcci√≥n o territorio</label>
          <input id="buscador-interesados" type="text" placeholder="Escrib√≠ para filtrar..." oninput="renderInteresados()" />

          <div id="lista-interesados"></div>
          <p id="msg-sin-interesados" class="small-text" style="margin-top:0.5rem; display:none;">
            Todav√≠a no cargaste interesados.
          </p>
        </div>
      </section>

      <!-- INFORME -->
      <section id="sec-informe" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Mi informe</h2>
            <span class="chip" id="chip-mes-informe"></span>
          </div>
          <h3>Meta mensual</h3>
          <div class="flex-row">
            <div class="flex-1">
              <label for="meta-horas">Horas meta (mes actual)</label>
              <input id="meta-horas" type="number" min="0" step="0.5" />
            </div>
          </div>
          <button onclick="guardarMetaHoras()">Guardar meta</button>
          <div id="status-meta" class="status-ok" style="display:none;"></div>
        </div>

        <div class="card">
          <h3>Registro diario</h3>
          <div class="flex-row">
            <div class="flex-1">
              <label for="reg-fecha">Fecha</label>
              <input id="reg-fecha" type="date" />
            </div>
            <div style="width:110px;">
              <label for="reg-horas">Horas</label>
              <input id="reg-horas" type="number" min="0" step="0.25" />
            </div>
          </div>
          <label for="reg-notas">Notas</label>
          <textarea id="reg-notas" placeholder="Actividad, con qui√©n saliste, detalles..."></textarea>

          <button onclick="agregarRegistroDiario()">Agregar al registro</button>
          <div id="status-registro" class="status-ok" style="display:none;"></div>
        </div>

        <div class="card">
          <h3>Resumen del mes</h3>
          <div id="resumen-mes"></div>
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Horas</th>
                <th>Notas</th>
                <th></th>
              </tr>
            </thead>
            <tbody id="tabla-registro-diario"></tbody>
          </table>
          <p id="msg-sin-registro" class="small-text" style="margin-top:0.5rem; display:none;">
            Todav√≠a no cargaste registros para este mes.
          </p>
        </div>
      </section>
    </main>
  </div>

  <!-- NAV inferior -->
  <div class="bottom-nav">
    <button id="nav-inicio" class="active" onclick="cambiarSeccion('inicio')">
      <span class="icon">üè†</span>
      Inicio
    </button>
    <button id="nav-salidas" onclick="cambiarSeccion('salidas')">
      <span class="icon">üìÖ</span>
      Salidas
    </button>
    <button id="nav-territorios" onclick="cambiarSeccion('territorios')">
      <span class="icon">üó∫Ô∏è</span>
      Territorios
    </button>
    <button id="nav-interesados" onclick="cambiarSeccion('interesados')">
      <span class="icon">üë•</span>
      Interesados
    </button>
    <button id="nav-informe" onclick="cambiarSeccion('informe')">
      <span class="icon">‚è±Ô∏è</span>
      Informe
    </button>
  </div>

  <script>
    // ==== Constantes / helpers generales ====

    const LS_SALIDAS = "territorios_salidasSemana";
    const LS_TERRITORIOS = "territorios_lista";
    const LS_INTERESADOS = "territorios_interesados";
    const LS_META_HORAS = "territorios_metaHoras";
    const LS_REGISTRO = "territorios_registroDiario";

    const DIAS = [
      "Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado","Domingo"
    ];

    function hoyISO() {
      const d = new Date();
      return d.toISOString().slice(0,10);
    }

    function mesActualClave() {
      return hoyISO().slice(0,7); // YYYY-MM
    }

    function mostrarStatus(id, msg, ok=true) {
      const el = document.getElementById(id);
      if (!el) return;
      el.textContent = msg;
      el.style.display = "block";
      el.className = ok ? "status-ok" : "status-error";
      setTimeout(() => {
        el.style.display = "none";
      }, 1500);
    }

    function cambiarSeccion(id) {
      const sections = ["inicio","salidas","territorios","interesados","informe"];
      sections.forEach(sec => {
        const secEl = document.getElementById("sec-"+sec);
        const navEl = document.getElementById("nav-"+sec);
        if (sec === id) {
          secEl.classList.add("active");
          navEl.classList.add("active");
        } else {
          secEl.classList.remove("active");
          navEl.classList.remove("active");
        }
      });

      if (id === "informe") {
        actualizarResumenInforme();
      }
    }

    // ==== Salidas de semana ====

    function cargarSalidasSemana() {
      const dataStr = localStorage.getItem(LS_SALIDAS);
      let salidas = [];
      if (dataStr) {
        try {
          salidas = JSON.parse(dataStr);
        } catch(e) {}
      }
      if (!Array.isArray(salidas) || salidas.length !== 7) {
        salidas = DIAS.map(d => ({ dia: d, manana: "", tarde: "" }));
      }
      return salidas;
    }

    function renderSalidasSemana() {
      const cont = document.getElementById("contenedor-salidas-semana");
      cont.innerHTML = "";
      const salidas = cargarSalidasSemana();

      salidas.forEach((fila, idx) => {
        const row = document.createElement("div");
        row.className = "salidas-grid";
        row.innerHTML = `
          <div class="small-text">${fila.dia}</div>
          <div><input type="text" id="salida-manana-${idx}" value="${fila.manana || ""}" placeholder="Ej: Territorio 1" /></div>
          <div><input type="text" id="salida-tarde-${idx}" value="${fila.tarde || ""}" placeholder="Ej: Territorio 2" /></div>
        `;
        cont.appendChild(row);
      });
    }

    function guardarSalidasSemana() {
      const salidas = DIAS.map((dia, idx) => ({
        dia,
        manana: document.getElementById("salida-manana-"+idx).value.trim(),
        tarde: document.getElementById("salida-tarde-"+idx).value.trim()
      }));
      localStorage.setItem(LS_SALIDAS, JSON.stringify(salidas));
      mostrarStatus("status-salidas","Programa guardado ‚úÖ",true);
      renderSalidasHoy();
    }

    function renderSalidasHoy() {
      const chip = document.getElementById("chip-fecha-hoy");
      const cont = document.getElementById("bloque-salidas-hoy");
      const hoy = new Date();
      const diaIndex = (hoy.getDay() + 6) % 7; // 0 lunes ... 6 domingo
      const fechaStr = hoy.toLocaleDateString("es-AR", {
        weekday: "long",
        day: "numeric",
        month: "long"
      });

      chip.textContent = fechaStr.charAt(0).toUpperCase() + fechaStr.slice(1);

      const salidas = cargarSalidasSemana();
      const hoyFila = salidas[diaIndex];

      if (!hoyFila || (!hoyFila.manana && !hoyFila.tarde)) {
        cont.innerHTML = `<p class="small-text">Para hoy no hay salidas configuradas en el programa semanal.</p>`;
        return;
      }

      let html = "";
      if (hoyFila.manana) {
        html += `<p><strong>Ma√±ana:</strong> ${hoyFila.manana}</p>`;
      }
      if (hoyFila.tarde) {
        html += `<p><strong>Tarde:</strong> ${hoyFila.tarde}</p>`;
      }

      cont.innerHTML = html;
    }

    // ==== Territorios ====

    function cargarTerritorios() {
      const dataStr = localStorage.getItem(LS_TERRITORIOS);
      let lista = [];
      if (dataStr) {
        try { lista = JSON.parse(dataStr); } catch(e){}
      }
      if (!Array.isArray(lista)) lista = [];
      return lista;
    }

    function guardarTerritorios(lista) {
      localStorage.setItem(LS_TERRITORIOS, JSON.stringify(lista));
    }

    function renderTerritorios() {
      const lista = cargarTerritorios();
      const tbody = document.getElementById("tabla-territorios");
      const chip = document.getElementById("chip-total-territorios");
      const msgSin = document.getElementById("msg-sin-territorios");

      tbody.innerHTML = "";
      chip.textContent = `${lista.length} registrados`;

      if (!lista.length) {
        msgSin.style.display = "block";
        return;
      }
      msgSin.style.display = "none";

      lista.forEach((t, idx) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${t.nombre || ""}</td>
          <td>${t.notas || ""}</td>
          <td>
            <div style="display:flex; align-items:center; gap:0.3rem;">
              <div style="width:16px; height:16px; border-radius:4px; border:1px solid #d1d5db; background:${t.color || "#ffffff"};"></div>
              <span class="small-text">${t.color || ""}</span>
            </div>
          </td>
          <td>
            <button class="btn-danger btn-small" onclick="eliminarTerritorio(${idx})">‚úï</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function agregarTerritorio() {
      const nombre = document.getElementById("territorio-nombre").value.trim();
      const color = document.getElementById("territorio-color").value;
      const notas = document.getElementById("territorio-notas").value.trim();

      if (!nombre) {
        mostrarStatus("status-territorio","Pon√© un nombre o n√∫mero de territorio",false);
        return;
      }

      const lista = cargarTerritorios();
      lista.push({
        id: Date.now(),
        nombre,
        color,
        notas
      });
      guardarTerritorios(lista);
      renderTerritorios();

      document.getElementById("territorio-nombre").value = "";
      document.getElementById("territorio-notas").value = "";
      mostrarStatus("status-territorio","Territorio agregado ‚úÖ",true);
    }

    function eliminarTerritorio(idx) {
      const lista = cargarTerritorios();
      if (idx < 0 || idx >= lista.length) return;
      if (!confirm("¬øEliminar este territorio?")) return;
      lista.splice(idx,1);
      guardarTerritorios(lista);
      renderTerritorios();
    }

    // ==== Interesados ====

    function cargarInteresados() {
      const dataStr = localStorage.getItem(LS_INTERESADOS);
      let lista = [];
      if (dataStr) {
        try { lista = JSON.parse(dataStr); } catch(e){}
      }
      if (!Array.isArray(lista)) lista = [];
      return lista;
    }

    function guardarInteresados(lista) {
      localStorage.setItem(LS_INTERESADOS, JSON.stringify(lista));
    }

    function agregarInteresado() {
      const nombre = document.getElementById("int-nombre").value.trim();
      const dir = document.getElementById("int-direccion").value.trim();
      const tel = document.getElementById("int-telefono").value.trim();
      const terr = document.getElementById("int-territorio").value.trim();
      const notas = document.getElementById("int-notas").value.trim();

      if (!nombre) {
        mostrarStatus("status-interesado","Pon√© al menos el nombre",false);
        return;
      }

      const lista = cargarInteresados();
      lista.push({
        id: Date.now(),
        nombre,
        direccion: dir,
        telefono: tel,
        territorio: terr,
        notas
      });
      guardarInteresados(lista);

      document.getElementById("int-nombre").value = "";
      document.getElementById("int-direccion").value = "";
      document.getElementById("int-telefono").value = "";
      document.getElementById("int-territorio").value = "";
      document.getElementById("int-notas").value = "";

      renderInteresados();
      mostrarStatus("status-interesado","Interesado agregado ‚úÖ",true);
    }

    function eliminarInteresado(id) {
      const lista = cargarInteresados();
      const idx = lista.findIndex(i => i.id === id);
      if (idx === -1) return;
      if (!confirm("¬øEliminar este interesado?")) return;
      lista.splice(idx,1);
      guardarInteresados(lista);
      renderInteresados();
    }

    function renderInteresados() {
      const lista = cargarInteresados();
      const cont = document.getElementById("lista-interesados");
      const chip = document.getElementById("chip-total-interesados");
      const msgSin = document.getElementById("msg-sin-interesados");
      const filtro = document.getElementById("buscador-interesados").value.trim().toLowerCase();

      chip.textContent = `${lista.length} contactos`;
      cont.innerHTML = "";

      const filtrados = lista.filter(i => {
        if (!filtro) return true;
        const txt = (i.nombre + " " + i.direccion + " " + i.territorio).toLowerCase();
        return txt.includes(filtro);
      });

      if (!lista.length) {
        msgSin.style.display = "block";
      } else {
        msgSin.style.display = "none";
      }

      if (!filtrados.length && lista.length) {
        cont.innerHTML = `<p class="small-text">No hay resultados para ese filtro.</p>`;
        return;
      }

      filtrados.forEach(i => {
        const div = document.createElement("div");
        div.className = "interesado-card";
        div.innerHTML = `
          <div class="interesado-nombre">${i.nombre}</div>
          <div class="interesado-detalle">
            ${i.direccion ? "<strong>Direcci√≥n:</strong> "+i.direccion+"<br/>" : ""}
            ${i.telefono ? "<strong>Tel:</strong> "+i.telefono+"<br/>" : ""}
            ${i.territorio ? "<strong>Territorio:</strong> "+i.territorio+"<br/>" : ""}
            ${i.notas ? "<strong>Notas:</strong> "+i.notas : ""}
          </div>
          <div style="margin-top:0.25rem;">
            <button class="btn-danger btn-small" onclick="eliminarInteresado(${i.id})">Eliminar</button>
          </div>
        `;
        cont.appendChild(div);
      });
    }

    // ==== Informe personal ====

    function cargarMetaHoras() {
      const dataStr = localStorage.getItem(LS_META_HORAS);
      if (!dataStr) return {};
      try { return JSON.parse(dataStr); } catch(e){}
      return {};
    }

    function guardarMetaHoras() {
      const metaHorasStr = document.getElementById("meta-horas").value.trim();
      const meta = metaHorasStr ? parseFloat(metaHorasStr) : 0;
      const metas = cargarMetaHoras();
      metas[mesActualClave()] = isNaN(meta) ? 0 : meta;
      localStorage.setItem(LS_META_HORAS, JSON.stringify(metas));
      mostrarStatus("status-meta","Meta guardada ‚úÖ",true);
      actualizarResumenInforme();
    }

    function cargarRegistro() {
      const dataStr = localStorage.getItem(LS_REGISTRO);
      let lista = [];
      if (dataStr) {
        try { lista = JSON.parse(dataStr); } catch(e){}
      }
      if (!Array.isArray(lista)) lista = [];
      return lista;
    }

    function guardarRegistro(lista) {
      localStorage.setItem(LS_REGISTRO, JSON.stringify(lista));
    }

    function agregarRegistroDiario() {
      const fecha = document.getElementById("reg-fecha").value || hoyISO();
      const horasStr = document.getElementById("reg-horas").value.trim();
      const horas = horasStr ? parseFloat(horasStr) : 0;
      const notas = document.getElementById("reg-notas").value.trim();

      if (!horas || isNaN(horas)) {
        mostrarStatus("status-registro","Indic√° cu√°ntas horas hiciste",false);
        return;
      }

      const lista = cargarRegistro();
      lista.push({
        id: Date.now(),
        fecha,
        horas,
        notas
      });
      guardarRegistro(lista);

      document.getElementById("reg-fecha").value = "";
      document.getElementById("reg-horas").value = "";
      document.getElementById("reg-notas").value = "";

      mostrarStatus("status-registro","Registro agregado ‚úÖ",true);
      actualizarResumenInforme();
    }

    function eliminarRegistro(id) {
      const lista = cargarRegistro();
      const idx = lista.findIndex(r => r.id === id);
      if (idx === -1) return;
      if (!confirm("¬øEliminar este registro?")) return;
      lista.splice(idx,1);
      guardarRegistro(lista);
      actualizarResumenInforme();
    }

    function actualizarResumenInforme() {
      const mesClave = mesActualClave();
      const chip = document.getElementById("chip-mes-informe");
      const resumenDiv = document.getElementById("resumen-mes");
      const tbody = document.getElementById("tabla-registro-diario");
      const msgSin = document.getElementById("msg-sin-registro");

      const fecha = new Date();
      const nombreMes = fecha.toLocaleDateString("es-AR",{month:"long", year:"numeric"});
      chip.textContent = nombreMes.charAt(0).toUpperCase()+nombreMes.slice(1);

      const metas = cargarMetaHoras();
      const meta = metas[mesClave] || 0;
      const registros = cargarRegistro().filter(r => (r.fecha || "").startsWith(mesClave));

      tbody.innerHTML = "";

      if (!registros.length) {
        msgSin.style.display = "block";
      } else {
        msgSin.style.display = "none";
      }

      let total = 0;
      registros.sort((a,b) => (a.fecha || "").localeCompare(b.fecha || ""));
      registros.forEach(r => {
        total += r.horas || 0;
        const tr = document.createElement("tr");
        const fechaFmt = new Date(r.fecha+"T00:00:00").toLocaleDateString("es-AR",{day:"2-digit", month:"2-digit"});
        tr.innerHTML = `
          <td>${fechaFmt}</td>
          <td>${(r.horas || 0).toFixed(2)}</td>
          <td>${r.notas || ""}</td>
          <td><button class="btn-danger btn-small" onclick="eliminarRegistro(${r.id})">‚úï</button></td>
        `;
        tbody.appendChild(tr);
      });

      let diff = meta - total;
      let textoMeta = "";
      if (!meta) {
        textoMeta = "No configuraste una meta de horas para este mes.";
      } else if (diff <= 0) {
        textoMeta = `Meta de ${meta.toFixed(2)} horas alcanzada ‚úÖ (llev√°s ${total.toFixed(2)} h).`;
      } else {
        textoMeta = `Llev√°s ${total.toFixed(2)} h de ${meta.toFixed(2)} h. Te faltan ${diff.toFixed(2)} h.`;
      }

      resumenDiv.innerHTML = `
        <div class="resumen-linea">
          <span>Total de horas del mes</span>
          <strong>${total.toFixed(2)} h</strong>
        </div>
        <div class="resumen-linea">
          <span>Meta configurada</span>
          <strong>${meta ? meta.toFixed(2)+" h" : "Sin meta"}</strong>
        </div>
        <p class="small-text" style="margin-top:0.4rem;">${textoMeta}</p>
      `;

      // Mostrar meta actual en input
      document.getElementById("meta-horas").value = meta || "";
    }

    // ==== Init ====

    window.addEventListener("load", () => {
      // Territorio color preview
      const colorInp = document.getElementById("territorio-color");
      const colorPrev = document.getElementById("territorio-color-preview");
      colorPrev.style.background = colorInp.value;
      colorInp.addEventListener("input", () => {
        colorPrev.style.background = colorInp.value;
      });

      // Salidas
      renderSalidasSemana();
      renderSalidasHoy();

      // Territorios / interesados / informe
      renderTerritorios();
      renderInteresados();
      actualizarResumenInforme();

      // Fecha por defecto en registro diario
      const regFecha = document.getElementById("reg-fecha");
      if (regFecha) regFecha.value = hoyISO();
    });
  </script>
</body>
</html>
